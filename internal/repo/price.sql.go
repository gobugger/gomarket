// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: price.sql

package repo

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const createPriceTier = `-- name: CreatePriceTier :one
INSERT INTO price_tiers (
	quantity, price_cent, product_id
) VALUES ($1, $2, $3) 
RETURNING id, product_id, quantity, price_cent, deleted_at
`

type CreatePriceTierParams struct {
	Quantity  int32
	PriceCent int64
	ProductID uuid.UUID
}

func (q *Queries) CreatePriceTier(ctx context.Context, arg CreatePriceTierParams) (PriceTier, error) {
	row := q.db.QueryRow(ctx, createPriceTier, arg.Quantity, arg.PriceCent, arg.ProductID)
	var i PriceTier
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.Quantity,
		&i.PriceCent,
		&i.DeletedAt,
	)
	return i, err
}

const getAllPriceTiers = `-- name: GetAllPriceTiers :many
SELECT id, product_id, quantity, price_cent, deleted_at
FROM price_tiers
WHERE deleted_at IS NULL
`

func (q *Queries) GetAllPriceTiers(ctx context.Context) ([]PriceTier, error) {
	rows, err := q.db.Query(ctx, getAllPriceTiers)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PriceTier
	for rows.Next() {
		var i PriceTier
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.Quantity,
			&i.PriceCent,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getPriceTier = `-- name: GetPriceTier :one
SELECT id, product_id, quantity, price_cent, deleted_at FROM price_tiers
WHERE id = $1
`

func (q *Queries) GetPriceTier(ctx context.Context, id uuid.UUID) (PriceTier, error) {
	row := q.db.QueryRow(ctx, getPriceTier, id)
	var i PriceTier
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.Quantity,
		&i.PriceCent,
		&i.DeletedAt,
	)
	return i, err
}

const getPriceTiers = `-- name: GetPriceTiers :many
SELECT id, product_id, quantity, price_cent, deleted_at 
FROM price_tiers
WHERE product_id = $1 AND price_tiers.deleted_at IS NULL
`

func (q *Queries) GetPriceTiers(ctx context.Context, productID uuid.UUID) ([]PriceTier, error) {
	rows, err := q.db.Query(ctx, getPriceTiers, productID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PriceTier
	for rows.Next() {
		var i PriceTier
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.Quantity,
			&i.PriceCent,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getPriceTiersForCart = `-- name: GetPriceTiersForCart :many
SELECT price_tiers.id, price_tiers.product_id, price_tiers.quantity, price_tiers.price_cent, price_tiers.deleted_at,
	COUNT(cart_items.price_id)
FROM cart_items
JOIN price_tiers ON price_tiers.id = cart_items.price_id
JOIN products ON products.id = price_tiers.product_id AND products.vendor_id = $2
WHERE cart_items.customer_id = $1
GROUP BY price_tiers.id, cart_items.customer_id
`

type GetPriceTiersForCartParams struct {
	CustomerID uuid.UUID
	VendorID   uuid.UUID
}

type GetPriceTiersForCartRow struct {
	ID        uuid.UUID
	ProductID uuid.UUID
	Quantity  int32
	PriceCent int64
	DeletedAt pgtype.Timestamptz
	Count     int64
}

func (q *Queries) GetPriceTiersForCart(ctx context.Context, arg GetPriceTiersForCartParams) ([]GetPriceTiersForCartRow, error) {
	rows, err := q.db.Query(ctx, getPriceTiersForCart, arg.CustomerID, arg.VendorID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetPriceTiersForCartRow
	for rows.Next() {
		var i GetPriceTiersForCartRow
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.Quantity,
			&i.PriceCent,
			&i.DeletedAt,
			&i.Count,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getVendorForPriceTier = `-- name: GetVendorForPriceTier :one
SELECT users.id, users.username, users.password_hash, users.pgp_key, users.prev_login, users.locale, users.currency, users.twofa_enabled, users.incognito_enabled, users.created_at
FROM price_tiers 
JOIN products ON products.id = price_tiers.product_id
JOIN users ON users.id = products.vendor_id	
WHERE price_tiers.id = $1
`

func (q *Queries) GetVendorForPriceTier(ctx context.Context, id uuid.UUID) (User, error) {
	row := q.db.QueryRow(ctx, getVendorForPriceTier, id)
	var i User
	err := row.Scan(
		&i.ID,
		&i.Username,
		&i.PasswordHash,
		&i.PgpKey,
		&i.PrevLogin,
		&i.Locale,
		&i.Currency,
		&i.TwofaEnabled,
		&i.IncognitoEnabled,
		&i.CreatedAt,
	)
	return i, err
}
